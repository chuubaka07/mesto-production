(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-202",headers:{authorization:"2fa11413-8441-43bd-9234-3d75dc87463c","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),W=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(u),A=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(u),j=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(u),J=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(u),z=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(u),V=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(u),K=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(u),U=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",U)},l=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",U)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{l(e)}),e.addEventListener("mousedown",r=>{r.target.classList.contains("popup")&&l(e)})};function D(e,t,r,o){const n=e.querySelector(`#${t.name}-error`);n&&(t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass))}function G(e,t){const r=document.querySelector(`#${e.name}-error`);r&&(e.classList.remove(t.inputErrorClass),r.classList.remove(t.errorClass),r.textContent="")}function Q(e,t,r){let o="";t.validity.valid?G(t,r):(t.hasAttribute("data-error-message")?/^[a-zA-Zа-яА-ЯёЁ\s\-]+$/.test(t.value)?o=t.validationMessage:o=t.dataset.errorMessage:o=t.validationMessage,D(e,t,o,r))}function X(e){return e.some(t=>!t.validity.valid)}function F(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function Y(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function ee(e,t,r){X(e)?F(t,r):Y(t,r)}function te(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);F(o,t),r.forEach(n=>{n.addEventListener("input",()=>{Q(e,n,t),ee(r,o,t)})})}function oe(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(r=>{r.addEventListener("submit",o=>{o.preventDefault()}),te(r,e)})}const b=document.querySelector(".popup_type_edit"),C=b.querySelector(".popup__form"),N=C.querySelector(".popup__input_type_name"),O=C.querySelector(".popup__input_type_description"),L=document.querySelector(".popup_type_new-card"),m=L.querySelector(".popup__form"),re=m.querySelector(".popup__input_type_card-name"),ne=m.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_image"),B=q.querySelector(".popup__image"),ce=q.querySelector(".popup__caption"),se=document.querySelector(".profile__edit-button"),ie=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),a=document.querySelector(".popup_type_remove-card"),k=document.querySelector(".popup_type_edit-avatar"),I=k.querySelector(".popup__form"),ae=I.querySelector(".popup__input"),T=document.querySelector(".popup_type_info"),p=T.querySelector(".popup__info"),P=T.querySelector(".popup__list");var M;const le=(M=document.querySelector("#popup-info-definition-template"))==null?void 0:M.content;var $;const ue=($=document.querySelector("#popup-info-user-preview-template"))==null?void 0:$.content,H=document.querySelector(".places__list");let S;const de=({name:e,link:t})=>{B.src=t,B.alt=e,ce.textContent=e,d(q)},pe=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Сохранение...",j({name:N.value,about:O.value}).then(o=>{g.textContent=o.name,E.textContent=o.about,l(b)}).catch(o=>console.error(o)).finally(()=>{t.textContent=r})},me=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Сохранение...",J(ae.value).then(o=>{x.style.backgroundImage=`url(${o.avatar})`,l(k)}).catch(o=>console.error(o)).finally(()=>{t.textContent=r})},fe=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Создание...",z({name:re.value,link:ne.value}).then(o=>{const n=R(o,S);H.prepend(n),l(L),m.reset()}).catch(o=>console.error(o)).finally(()=>{t.textContent=r})};C.addEventListener("submit",pe);m.addEventListener("submit",fe);I.addEventListener("submit",me);se.addEventListener("click",()=>{N.value=g.textContent,O.value=E.textContent,d(b)});x.addEventListener("click",()=>{I.reset(),d(k)});ie.addEventListener("click",()=>{m.reset(),d(L)});const R=(e,t)=>{const o=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".card");o.dataset.cardId=e._id;const n=o.querySelector(".card__image"),c=o.querySelector(".card__title"),i=o.querySelector(".card__like-button"),_=o.querySelector(".card__like-count"),y=o.querySelector(".card__control-button_type_delete"),w=o.querySelector(".card__control-button_type_info");return!n||!c||!i||!_?(console.error("Не найдены обязательные элементы в шаблоне карточки:",o),o):(n.src=e.link,n.alt=e.name,c.textContent=e.name,_.textContent=e.likes.length,e.likes.some(h=>h._id===t)&&i.classList.add("card__like-button_is-active"),e.owner._id!==t&&y.remove(),n.addEventListener("click",()=>{de({name:e.name,link:e.link})}),i.addEventListener("click",()=>{const h=i.classList.contains("card__like-button_is-active");K(e._id,h).then(v=>{_.textContent=v.likes.length,i.classList.toggle("card__like-button_is-active")}).catch(v=>console.error(v))}),y&&y.addEventListener("click",()=>{d(a),a.dataset.cardId=e._id}),w&&w.addEventListener("click",()=>{ve(e._id)}),o)},_e=document.querySelectorAll(".popup");_e.forEach(e=>{Z(e)});const ye={formSelector:".popup__form:not([name='remove-card'])",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};oe(ye);const he=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),f=(e,t)=>{const r=le.cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},ve=e=>{p.innerHTML="",P.innerHTML="",A().then(t=>{const r=t.find(o=>o._id===e);if(!r)throw new Error("Карточка не найдена");p.append(f("Описание:",r.name)),p.append(f("Дата создания:",he(r.createdAt))),p.append(f("Владелец:",r.owner.name)),p.append(f("Количество лайков:",r.likes.length)),r.likes.length>0&&r.likes.forEach(o=>{const n=ue.cloneNode(!0);n.querySelector(".popup__list-item").textContent=o.name,P.append(n)}),d(T)}).catch(t=>console.error(t))};a==null||a.addEventListener("submit",e=>{e.preventDefault();const t=a.dataset.cardId;if(!t)return;const r=e.submitter,o=r.textContent;r.textContent="Удаление...",V(t).then(()=>{const n=document.querySelector(`[data-card-id="${t}"]`);n&&n.remove(),l(a)}).catch(n=>console.error(n)).finally(()=>{r.textContent=o})});Promise.all([A(),W()]).then(([e,t])=>{g.textContent=t.name,E.textContent=t.about,x.style.backgroundImage=`url(${t.avatar})`,S=t._id,e.forEach(r=>{const o=R(r,S);H.append(o)})}).catch(e=>{console.error("Ошибка загрузки данных:",e),alert("Не удалось загрузить данные. Проверьте подключение к серверу.")});
